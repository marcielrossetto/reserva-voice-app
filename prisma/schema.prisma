generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================================================
// EMPRESAS
// ============================================================================

model Empresa {
  id                    Int       @id @default(autoincrement())
  nomeEmpresa           String    @db.VarChar(255)
  cnpjCpf               String?   @unique @db.VarChar(20)
  telefone              String?   @db.VarChar(20)
  dataInclusao          DateTime?
  logo                  Bytes?
  logoCaminho           String?   @db.VarChar(500)
  dataCadastro          DateTime  @default(now())

  dataInicioTeste       DateTime?
  dataExpiracao         DateTime?
  status                Boolean   @default(true)
  statusPagamento       Int       @default(0)
  plano                 String    @default("mensal") @db.VarChar(50)
  valor                 Decimal   @default(0.00) @db.Decimal(10, 2)
  dataUltimoPagamento   DateTime?
  observacoes           String?   @db.Text
  excluida              Boolean   @default(false)
  dataExclusao          DateTime?

  // Relações
  usuarios              Usuario[]
  clientes              Cliente[]
  bebidasCadastro       BebidaCadastro[]
  filaEspera            FilaEspera[]
  filaBebidasVenda      FilaBebidas[]
  vouchers              Voucher[]
  precoRodizio          PrecoRodizio[]
  pagamentosMensais     PagamentoMensal[]
  filaConfigDia         FilaConfigDia[]
  menuProdutos          MenuProduto[]
  menuCardapios         MenuCardapio[]

  @@index([status])
  @@index([statusPagamento])
  @@index([excluida])
  @@map("empresas")
}

// ============================================================================
// USUÁRIOS
// ============================================================================

model Usuario {
  id            Int       @id @default(autoincrement())
  empresaId     Int
  nome          String    @db.VarChar(255)
  email         String    @unique @db.VarChar(255)
  senha         String    @db.VarChar(255)
  nivel         String    @db.VarChar(50)
  status        Boolean   @default(true)
  dataEmissao   DateTime  @default(now())
  ultimoAcesso  DateTime?

  empresa       Empresa   @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empresaId])
  @@index([email])
  @@index([status])
  @@map("login")
}

// ============================================================================
// CLIENTES - CORRIGIDO: horario como String (HH:MM:SS)
// ============================================================================

model Cliente {
  id                    Int       @id @default(autoincrement())
  empresaId             Int
  nome                  String    @db.VarChar(255)
  data                  DateTime
  numPessoas            Int
  horario         String  @db.VarChar(8)
  telefone              String?   @db.VarChar(20)
  telefone2             String?   @db.VarChar(20)
  tipoEvento            String?   @db.VarChar(100)
  formaPagamento        String?   @db.VarChar(50)
  valorRodizio          Int?
  numMesa               String?   @db.VarChar(20)
  observacoes           String?   @db.Text
  obsCliente            String?   @db.Text
  dataEmissao           DateTime  @default(now())
  status                Boolean   @default(true)
  confirmado            Boolean   @default(false)
  usuarioId             Int?
  motivoCancelamento    String?   @db.Text
  tortaTermoVela        Boolean   @default(false)
  churrascaria          Boolean   @default(false)
  executivo             Boolean   @default(false)

  empresa               Empresa   @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empresaId])
  @@index([data])
  @@index([status])
  @@map("clientes")
}

// ============================================================================
// BEBIDAS CADASTRADAS
// ============================================================================

model BebidaCadastro {
  id                    Int       @id @default(autoincrement())
  empresaId             Int
  nome                  String    @db.VarChar(255)
  precoAtual            Decimal   @default(0.00) @db.Decimal(10, 2)
  ativo                 Boolean   @default(true)
  dataCriacao           DateTime  @default(now())

  empresa               Empresa   @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empresaId])
  @@index([ativo])
  @@map("bebidas_cadastro")
}

// ============================================================================
// FILA DE ESPERA
// ============================================================================

model FilaEspera {
  id                    Int       @id @default(autoincrement())
  empresaId             Int
  nome                  String    @db.VarChar(255)
  telefone              String?   @db.VarChar(20)
  numPessoas            Int
  status                Int       @default(0)
  prioridade            Boolean   @default(false)
  prioMotivo            String?   @db.VarChar(100)
  numMesa               String?   @db.VarChar(20)
  horaSentado           DateTime?
  posicaoFila           Int?
  dataCriacao           DateTime  @default(now())

  empresa               Empresa   @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  bebidas               FilaBebidas[]

  @@index([empresaId])
  @@index([status])
  @@index([dataCriacao])
  @@map("fila_espera")
}

// ============================================================================
// BEBIDAS VENDIDAS NA FILA
// ============================================================================

model FilaBebidas {
  id                    Int       @id @default(autoincrement())
  filaId                Int
  empresaId             Int
  bebida                String    @db.VarChar(255)
  valor                 Float     @default(0)
  dataCriacao           DateTime  @default(now())

  fila                  FilaEspera @relation(fields: [filaId], references: [id], onDelete: Cascade)
  empresa               Empresa   @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([filaId])
  @@index([empresaId])
  @@index([dataCriacao])
  @@map("fila_bebidas")
}

// ============================================================================
// CONFIGURAÇÃO FILA POR DIA
// ============================================================================

model FilaConfigDia {
  id                    Int       @id @default(autoincrement())
  empresaId             Int
  dataConfig            DateTime  @db.Date
  numeroInicial         Int       @default(1)
  criadoEm              DateTime  @default(now())

  empresa               Empresa   @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@unique([empresaId, dataConfig])
  @@index([empresaId])
  @@map("fila_config_dia")
}

// ============================================================================
// CARDÁPIO
// ============================================================================

model MenuCardapio {
  id                    Int       @id @default(autoincrement())
  empresaId             Int
  nome                  String    @db.VarChar(255)
  ordem                 Int       @default(0)
  status                Boolean   @default(true)
  dataCriacao           DateTime  @default(now())

  empresa               Empresa   @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  categorias            MenuCategoria[]

  @@index([empresaId])
  @@index([status])
  @@map("menu_cardapios")
}

model MenuCategoria {
  id                    Int       @id @default(autoincrement())
  cardapioId            Int
  nome                  String    @db.VarChar(255)
  ordem                 Int       @default(0)
  layoutTipo            String    @default("vinho") @db.VarChar(50)
  status                Boolean   @default(true)
  dataCriacao           DateTime  @default(now())

  cardapio              MenuCardapio @relation(fields: [cardapioId], references: [id], onDelete: Cascade)
  produtos              MenuProduto[]

  @@index([cardapioId])
  @@index([status])
  @@map("menu_categorias")
}

model MenuProduto {
  id                    Int       @id @default(autoincrement())
  categoriaId           Int
  empresaId             Int
  codPdv                String?   @db.VarChar(50)
  nome                  String    @db.VarChar(255)
  descricao             String?   @db.Text
  preco                 Decimal   @default(0.00) @db.Decimal(10, 2)
  foto                  Bytes?
  fotoCaminho           String?   @db.VarChar(500)
  origemPais            String?   @db.VarChar(100)
  tipoUva               String?   @db.VarChar(100)
  tamanhoDose           String?   @db.VarChar(50)
  status                Boolean   @default(true)
  layoutTipo            String    @default("normal") @db.VarChar(50)
  ordem                 Int       @default(0)
  dataCriacao           DateTime  @default(now())

  empresa               Empresa   @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  categoria             MenuCategoria @relation(fields: [categoriaId], references: [id], onDelete: Cascade)

  @@index([categoriaId])
  @@index([empresaId])
  @@index([status])
  @@map("menu_produtos")
}

// ============================================================================
// PAGAMENTOS
// ============================================================================

model PagamentoMensal {
  id                    Int       @id @default(autoincrement())
  empresaId             Int
  ano                   Int
  mes                   Int
  dataRegistro          DateTime  @default(now())

  empresa               Empresa   @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@unique([empresaId, mes, ano])
  @@index([empresaId])
  @@map("pagamentos_mensais")
}

model PrecoRodizio {
  id                    Int       @id @default(autoincrement())
  empresaId             Int
  almoco                Decimal   @db.Decimal(10, 2)
  jantar                Decimal   @db.Decimal(10, 2)
  domingoAlmoco         Decimal   @db.Decimal(10, 2)
  outros                Decimal   @db.Decimal(10, 2)
  dataEmissao           DateTime  @default(now())
  campoManual1          String?   @db.VarChar(255)
  campoManual2          String?   @db.VarChar(255)

  empresa               Empresa   @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empresaId])
  @@map("preco_rodizio")
}

// ============================================================================
// VOUCHERS
// ============================================================================

model Voucher {
  id                    Int       @id @default(autoincrement())
  empresaId             Int
  codigoVoucher         String    @unique @db.VarChar(50)
  tokenSeguranca        String?   @db.VarChar(255)
  tipo                  String    @default("Cortesia") @db.VarChar(50)
  tipoRodizio           String?   @db.VarChar(100)
  valorRodizio          Decimal   @default(0.00) @db.Decimal(10, 2)
  possuiBebida          Boolean   @default(false)
  valorBebida           Decimal   @default(0.00) @db.Decimal(10, 2)
  qtdBebida             Int       @default(0)
  tipoBebida            String?   @db.VarChar(100)
  possuiSobremesa       Boolean   @default(false)
  valorSobremesa        Decimal   @default(0.00) @db.Decimal(10, 2)
  qtdSobremesa          Int       @default(0)
  tipoSobremesa         String?   @db.VarChar(100)
  subtotal              Decimal   @default(0.00) @db.Decimal(10, 2)
  valorTotal            Decimal   @default(0.00) @db.Decimal(10, 2)
  dataValidade          DateTime
  observacoes           String?   @db.Text
  status                String    @default("pendente") @db.VarChar(50)
  pago                  Boolean   @default(false)
  formaPagamento        String?   @db.VarChar(50)
  dataCriacao           DateTime  @default(now())
  nomeCliente           String?   @db.VarChar(255)
  telefoneCliente       String?   @db.VarChar(20)
  cpfCliente            String?   @db.VarChar(20)

  empresa               Empresa   @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@index([empresaId])
  @@index([status])
  @@index([dataValidade])
  @@map("vouchers")
}
