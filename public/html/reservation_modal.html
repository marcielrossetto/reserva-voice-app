<div class="modal fade" id="modalReserva" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div
      class="modal-content"
      style="border-radius: 22px; box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2)"
    >
      <div class="modal-header border-0">
        <h5 class="modal-title w-100 text-center fw-bold">Nova Reserva</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body p-4">
        <!-- √ÅREA DE IMPORTA√á√ÉO WHATSAPP -->
        <div class="mb-3">
          <label class="fw-bold small text-muted"
            >COLAR DADOS DO WHATSAPP</label
          >
          <textarea
            id="whats_dados"
            class="form-control bg-light border-0"
            rows="3"
            placeholder="Cole o texto aqui..."
          ></textarea>
          <div class="d-flex gap-2 mt-2">
            <button
              type="button"
              onclick="importarWhatsParaFormulario()"
              class="btn btn-sm btn-outline-secondary rounded-pill"
            >
              Importar p/ Form
            </button>
            <button
              type="button"
              onclick="analisarSalvarDireto()"
              class="btn btn-sm btn-secondary rounded-pill"
            >
              Salvar Direto
            </button>
          </div>
        </div>
        <hr />

        <!-- FORMUL√ÅRIO MANUAL -->
        <form
          id="formManual"
          onsubmit="
            event.preventDefault();
            verificarEEnviar();
          "
        >
          <!-- TELEFONE -->
          <div class="mb-3">
            <label class="form-label small fw-bold">Telefone:</label>
            <input
              type="text"
              id="res_telefone"
              name="telefone"
              class="form-control"
              maxlength="15"
              onkeyup="maskPhone(this)"
              onblur="buscarTelefone()"
            />
            <div class="form-check mt-1">
              <input
                class="form-check-input"
                type="checkbox"
                id="sem_telefone"
                onclick="toggleTelefone(this)"
              />
              <label
                class="form-check-label small text-muted"
                for="sem_telefone"
              >
                N√£o possuo o n√∫mero de telefone
              </label>
            </div>
          </div>

          <!-- CARD PERFIL CLIENTE (Injetado via JS) -->
          <div
            id="card-perfil-cliente"
            class="profile-card mb-3 p-3 border border-success rounded"
            style="display: none"
          >
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h6 id="card-nome-display" class="fw-bold mb-0">--</h6>
                <p id="card-telefone-display" class="small text-muted mb-1">
                  --
                </p>
                <p class="small mb-0">
                  √öltima visita:
                  <span id="card-ultima" class="fw-bold">--</span> (<span
                    id="card-tempo"
                    class="text-primary"
                    >--</span
                  >)
                </p>
                <p class="small mb-0 text-muted" style="font-size: 0.8rem">
                  Hist√≥rico: <span id="card-historico">--</span>
                </p>
              </div>
              <div class="text-end">
                <button
                  type="button"
                  class="btn btn-sm btn-light border mb-1"
                  onclick="trocarCliente()"
                >
                  Trocar</button
                ><br />
                <button
                  type="button"
                  class="btn btn-sm btn-light border"
                  onclick="editarCliente()"
                >
                  Editar Nome
                </button>
              </div>
            </div>
            <div
              id="area-obs-db"
              class="alert alert-warning py-1 px-2 small mt-2"
              style="display: none"
            >
              <strong>‚ö†Ô∏è Obs:</strong> <span id="txt-obs-db"></span>
            </div>
            <div class="row mt-2 text-center border-top pt-2">
              <div class="col-6">
                <small class="d-block text-muted">Reservas</small>
                <strong id="stat-reservas">0</strong>
              </div>
              <div class="col-6">
                <small class="d-block text-muted">Canceladas</small>
                <strong id="stat-cancelada" class="text-danger">0</strong>
              </div>
            </div>
          </div>

          <!-- NOME (exibido apenas se sem perfil) -->
          <div id="div-input-nome" class="mb-3">
            <label class="form-label small fw-bold">Nome:</label>
            <input
              type="text"
              id="res_nome"
              name="nome"
              class="form-control"
              required
            />
          </div>

          <!-- DATA E HOR√ÅRIO -->
         <!-- DATA E HOR√ÅRIO -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label small fw-bold">Data:</label>
              <input
                type="date"
                id="res_data"
                name="data"
                class="form-control"
                required
              />
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label small fw-bold">Hor√°rio:</label>
              <input
                type="time"
                id="res_horario"
                name="horario"
                class="form-control"
                required
              />
            </div>
          </div>

          <!-- N√ö PESSOAS (üìå CR√çTICO) -->
          <div class="row">
            <div class="col-md-4 mb-3">
              <label class="form-label small fw-bold">Pax:</label>
              <input
                type="number"
                id="res_num_pessoas"
                name="numPessoas"
                class="form-control"
                min="1"
                required
                placeholder="Ex: 4"
              />
              <small class="text-muted d-block mt-1"
                >‚ö†Ô∏è Campo obrigat√≥rio</small
              >
            </div>
            <div class="col-md-8 mb-3">
              <label class="form-label small fw-bold">Telefone Alt:</label>
              <input
                type="text"
                id="res_telefone2"
                name="telefone2"
                class="form-control"
                onkeyup="maskPhone(this)"
              />
            </div>
          </div>

          <!-- FORMA PAGAMENTO -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label small fw-bold"
                >Forma de Pagamento:</label
              >
              <select
                id="res_forma_pagamento"
                name="formaPagamento"
                class="form-select"
              >
                <option value="N√£o definido">Selecione</option>
                <option value="unica">√önica</option>
                <option value="individual">Individual</option>
                <option value="U (rod) I (beb)">
                  √önica (rod) Individual (beb)
                </option>
                <option value="outros">Outros</option>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label small fw-bold">Mesa:</label>
              <input
                type="text"
                id="res_num_mesa"
                name="numMesa"
                class="form-control"
                placeholder="Ex: Sal√£o 1 ou Mesa 5"
              />
            </div>
          </div>

          <!-- TIPO EVENTO -->
          <div class="mb-3">
            <label class="form-label small fw-bold">Tipo de Evento:</label>
            <select id="res_tipo_evento" name="tipoEvento" class="form-select">
              <option value="Manual">Manual</option>
              <option value="Aniversario">Anivers√°rio</option>
              <option value="Conf. fim de ano">
                Confraterniza√ß√£o Fim de Ano
              </option>
              <option value="Formatura">Formatura</option>
              <option value="Casamento">Casamento</option>
              <option value="Conf. Familia">Confraterniza√ß√£o Fam√≠lia</option>
            </select>
          </div>

          <!-- VALOR ROD√çZIO -->
          <div class="mb-3">
            <label class="form-label small fw-bold">Valor do Rod√≠zio:</label>
            <input
              type="text"
              id="res_valor_rodizio"
              name="valorRodizio"
              class="form-control"
              placeholder="Ex: 89.90"
            />
          </div>

          <!-- CHECKBOXES -->
          <div class="checkbox-area p-3 bg-light rounded-3 mb-3">
            <div class="form-check mb-2">
              <input
                class="form-check-input"
                type="checkbox"
                id="torta"
                name="tortaTermoVela"
              />
              <label class="form-check-label small fw-bold" for="torta">
                Ciente torta, Termo e vela
              </label>
            </div>
            <div class="d-flex gap-4">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="churras"
                  name="churrascaria"
                />
                <label class="form-check-label small fw-bold" for="churras"
                  >Churrascaria</label
                >
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="exec"
                  name="executivo"
                />
                <label class="form-check-label small fw-bold" for="exec"
                  >Executivo</label
                >
              </div>
            </div>
          </div>

          <!-- OBSERVA√á√ïES -->
          <div class="mb-3">
            <label class="form-label small fw-bold">Observa√ß√µes:</label>
            <textarea
              id="res_observacoes"
              name="observacoes"
              class="form-control"
              rows="2"
            ></textarea>
          </div>

          <button
            type="submit"
            id="btnSalvarManual"
            class="btn btn-primary w-100 rounded-pill py-2 fw-bold"
          >
            Cadastrar reserva
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<style>
  /* ===== LAYOUT GERAL ===== */
  #modalReserva .modal-dialog {
    max-width: 1200px;
  }

  #modalReserva .modal-content {
    border-radius: 20px;
    border: none;
  }

  #modalReserva .modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid #f0f0f0;
    background: #f9f9fb;
  }

  #modalReserva .modal-title {
    font-size: 1.25rem;
    letter-spacing: 0.5px;
  }

  #modalReserva .modal-body {
    padding: 1.5rem;
  }

  /* ===== FORMUL√ÅRIO ===== */
  #formManual {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  #formManual .mb-3 {
    margin-bottom: 0.75rem !important;
  }

  #formManual .row {
    margin: 0 -6px;
  }

  #formManual .row > div {
    padding: 0 6px;
  }

  /* ===== LABELS ===== */
  .form-label {
    font-size: 0.85rem;
    font-weight: 700;
    color: #333;
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* ===== INPUTS ===== */
  .form-control,
  .form-select {
    border-radius: 12px;
    border: 1px solid #d1d1d6;
    padding: 0.75rem 1rem;
    background: #f9f9fb;
    font-size: 0.95rem;
    transition: all 0.2s ease;
  }

  .form-control:focus,
  .form-select:focus {
    border-color: #007aff;
    background: #fff;
    box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
  }

  /* ===== CHECKBOXES ===== */
  .checkbox-area {
    background: #f8f9fa;
    border: 1px solid #d1d1d6;
    border-radius: 12px;
    padding: 1.25rem;
    margin-bottom: 1rem;
  }

  .form-check {
    display: flex;
    align-items: center;
    margin-bottom: 0.75rem;
  }

  .form-check-input {
    width: 1.25rem;
    height: 1.25rem;
    margin-top: 0;
    cursor: pointer;
    border-radius: 4px;
    border: 1.5px solid #d1d1d6;
  }

  .form-check-input:checked {
    background-color: #007aff;
    border-color: #007aff;
  }

  .form-check-label {
    font-weight: 600;
    color: #333;
    cursor: pointer;
    margin-left: 0.75rem;
    margin-bottom: 0;
  }

  /* ===== PROFILE CARD ===== */
  .profile-card {
    background: #f0f9f0;
    border: 2px solid #28a745;
    border-radius: 12px;
    padding: 1rem;
    margin-bottom: 1rem;
  }

  .profile-card h6 {
    font-size: 1.05rem;
    color: #333;
    margin-bottom: 0.25rem;
  }

  .profile-card .small {
    font-size: 0.85rem;
    line-height: 1.4;
  }

  .profile-card .btn-sm {
    padding: 0.4rem 0.8rem;
    font-size: 0.8rem;
  }

  /* ===== ALERT/WARNING ===== */
  .alert-warning {
    background: #fff8e1;
    border: 1px solid #ffd700;
    border-radius: 8px;
    padding: 0.75rem;
    font-size: 0.85rem;
    margin-top: 0.75rem;
  }

  /* ===== TEXTAREA ===== */
  textarea.form-control {
    resize: vertical;
    min-height: 60px;
  }

  /* ===== BOT√ÉO SUBMIT ===== */
  #btnSalvarManual {
    background: #007aff;
    border: none;
    color: white;
    border-radius: 12px;
    padding: 0.9rem 1.5rem;
    font-weight: 700;
    font-size: 0.95rem;
    letter-spacing: 0.5px;
    margin-top: 1rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  #btnSalvarManual:hover:not(:disabled) {
    background: #0056b3;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
  }

  #btnSalvarManual:active:not(:disabled) {
    transform: translateY(0);
  }

  #btnSalvarManual:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  /* ===== TEXTAREA IMPORT ===== */
  #whats_dados {
    background: #f9f9fb;
    border-radius: 12px;
    border: 1px solid #d1d1d6;
    resize: vertical;
  }

  /* ===== BOT√ïES IMPORT ===== */
  .btn-outline-secondary,
  .btn-secondary {
    border-radius: 20px;
    padding: 0.5rem 1rem;
    font-size: 0.85rem;
    font-weight: 600;
    transition: all 0.2s ease;
  }

  .btn-outline-secondary {
    border-color: #d1d1d6;
    color: #333;
  }

  .btn-outline-secondary:hover {
    background: #f0f0f0;
    border-color: #d1d1d6;
  }

  .btn-secondary {
    background: #5e5e62;
    border-color: #5e5e62;
  }

  .btn-secondary:hover {
    background: #3a3a3d;
    border-color: #3a3a3d;
  }

  /* ===== FORM-CHECK CHECKBOX SEM TELEFONE ===== */
  .form-check.mt-1 {
    margin-top: 0.5rem !important;
  }

  .form-check-label.small {
    font-size: 0.8rem;
    font-weight: 500;
  }

  /* ===== HR ===== */
  hr {
    margin: 1.25rem 0;
    border: none;
    border-top: 1px solid #e0e0e0;
  }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 576px) {
    #modalReserva .modal-dialog {
      margin: 0.5rem;
      max-width: calc(100% - 1rem);
    }

    #modalReserva .modal-body {
      padding: 1rem;
    }

    #formManual .row > div {
      margin-bottom: 0.5rem;
    }

    .checkbox-area {
      padding: 1rem;
    }

    .d-flex.gap-4 {
      gap: 1.5rem !important;
    }
  }

  /* ===== ESTADO CARREGANDO ===== */
  .btn:disabled {
    pointer-events: none;
  }
</style>
